(function(t){function e(e){for(var a,o,i=e[0],l=e[1],c=e[2],m=0,d=[];m<i.length;m++)o=i[m],r[o]&&d.push(r[o][0]),r[o]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);u&&u(e);while(d.length)d.shift()();return n.push.apply(n,c||[]),s()}function s(){for(var t,e=0;e<n.length;e++){for(var s=n[e],a=!0,i=1;i<s.length;i++){var l=s[i];0!==r[l]&&(a=!1)}a&&(n.splice(e--,1),t=o(o.s=s[0]))}return t}var a={},r={app:0},n=[];function o(e){if(a[e])return a[e].exports;var s=a[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=t,o.c=a,o.d=function(t,e,s){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(s,a,function(e){return t[e]}.bind(null,a));return s},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],l=i.push.bind(i);i.push=e,i=i.slice();for(var c=0;c<i.length;c++)e(i[c]);var u=l;n.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"034f":function(t,e,s){"use strict";var a=s("64a9"),r=s.n(a);r.a},"03f2":function(t,e,s){"use strict";var a=s("fa43"),r=s.n(a);r.a},1:function(t,e){},"145a":function(t,e,s){"use strict";var a=s("39e5"),r=s.n(a);r.a},2:function(t,e){},"25da":function(t,e,s){"use strict";var a=s("a3fa"),r=s.n(a);r.a},3:function(t,e){},"39e5":function(t,e,s){},4:function(t,e){},5:function(t,e){},"56d7":function(t,e,s){"use strict";s.r(e);s("cadf"),s("551c"),s("f751"),s("097d");var a=s("2b0e"),r=(s("9216"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("div",{staticClass:"header"},[s("nav",{staticClass:"navbar navbar-expand-lg navbar-dark bg-dark"},[s("div",{staticClass:"container"},[s("router-link",{staticClass:"navbar-brand font4 font-weight-bold",attrs:{to:"/"}},[t._v("BTcrash")]),t._m(0),s("div",{staticClass:"collapse navbar-collapse",attrs:{id:"navbarColor02"}},[s("ul",{staticClass:"navbar-nav mr-auto"}),t.user.email?s("form",{staticClass:"form-inline my-2 my-lg-0",on:{submit:function(e){return e.preventDefault(),t.logout(e)}}},[s("span",{staticClass:"navbar-brand"},[s("kbd",[t._v(t._s(t.user.rub)+" rub")]),t._v(" "+t._s(t.user.email)+"\n              "),s("button",{staticClass:"btn btn-warning ml-3"},[t._v("Выйти")])])]):s("div",{staticClass:"form-inline my-2 my-lg-0"},[s("router-link",{staticClass:"btn btn-primary ml-3",attrs:{to:"/login"}},[t._v("Логин")]),t._v(" \n              "),s("router-link",{staticClass:"btn btn-primary ml-3",attrs:{to:"/signup"}},[t._v("Регистрация")])],1)])],1)])]),s("router-view",{attrs:{user:t.user}})],1)}),n=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button",{staticClass:"navbar-toggler",attrs:{type:"button","data-toggle":"collapse","data-target":"#navbarColor02","aria-controls":"navbarColor02","aria-expanded":"false","aria-label":"Toggle navigation"}},[s("span",{staticClass:"navbar-toggler-icon"})])}],o="http://localhost:5000",i={name:"app",computed:{user:function(){return this.$store.state.user},routerProps:function(){return{user:this.$store.state.user}}},mounted:function(){var t=this;"/signup"!==this.$route.fullPath&&fetch(o,{headers:{authorization:"Bearer ".concat(localStorage.token)}}).then(function(t){return t.json()}).then(function(e){e.user?t.$store.commit("setUser",e.user):(t.$store.commit("setUser",{}),localStorage.removeItem("token"),t.$router.push("login"))})},methods:{logout:function(){this.$store.commit("setUser",{}),localStorage.removeItem("token"),this.$router.push("login")}}},l=i,c=(s("034f"),s("2877")),u=Object(c["a"])(l,r,n,!1,null,null,null),m=u.exports,d=s("8c4f"),f=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"home"},[s("div",{staticClass:"container text-center"},[s("div",{staticClass:"jumbotron"},[s("h1",{staticClass:"display-3"},[t._v("Добро пожаловать")]),s("p",{staticClass:"lead"},[t._v("BTcrash - Игра на железные нервы")]),s("hr",{staticClass:"my-4"}),s("p",[t._v("Успей выйти раньше, чем обрушится мяч и забери выигрыш!")]),s("p",{staticClass:"lead"},[s("router-link",{staticClass:"btn btn-primary btn-lg",attrs:{to:"crash"}},[t._v("К игре")])],1)])])])},p=[],v={name:"home"},g=v,h=(s("03f2"),Object(c["a"])(g,f,p,!1,null,"43407ca0",null)),b=h.exports,_=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"mt-30 container text-center"},[t.errorMessage?a("div",{staticClass:"alert alert-warning alert-dismissible fade show",attrs:{role:"alert"}},[a("strong",[t._v(t._s(t.errorMessage))])]):t._e(),a("form",{on:{submit:function(e){return e.preventDefault(),t.signup(e)}}},[a("div",{staticClass:"form-group row"},[a("label",{staticClass:"col-sm-2 col-form-label"},[t._v("Логин:")]),a("div",{staticClass:"col-sm-10"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.user.email,expression:"user.email"}],staticClass:"form-control",attrs:{type:"text",id:"email",required:""},domProps:{value:t.user.email},on:{input:function(e){e.target.composing||t.$set(t.user,"email",e.target.value)}}})])]),a("div",{staticClass:"form-group row"},[a("label",{staticClass:"col-sm-2 col-form-label"},[t._v("Пароль:")]),a("div",{staticClass:"col-sm-10"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.user.password,expression:"user.password"}],staticClass:"form-control",attrs:{type:"password",id:"password",required:""},domProps:{value:t.user.password},on:{input:function(e){e.target.composing||t.$set(t.user,"password",e.target.value)}}})])]),a("div",{staticClass:"form-group row"},[a("label",{staticClass:"col-sm-2 col-form-label"},[t._v("Еще раз:")]),a("div",{staticClass:"col-sm-10"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.user.confirmPassword,expression:"user.confirmPassword"}],staticClass:"form-control",attrs:{type:"password",id:"confirmPassword",required:""},domProps:{value:t.user.confirmPassword},on:{input:function(e){e.target.composing||t.$set(t.user,"confirmPassword",e.target.value)}}})])]),t.signingUp?a("img",{staticClass:"spinner",attrs:{src:s("5c3d")}}):a("button",{staticClass:"btn btn-primary",attrs:{type:"submit"}},[t._v("Зарегистрироваться")])])])},C=[],w=s("f499"),k=s.n(w),y=(s("6762"),s("2fdb"),s("ac6a"),s("f0b1")),x=s.n(y),$="http://localhost:5000/auth/signup",P=x.a.object().keys({email:x.a.string().required(),password:x.a.string().trim().min(6).required(),confirmPassword:x.a.string().trim().min(6).required()}),j={data:function(){return{signingUp:!1,errorMessage:"",user:{email:"",password:"",confirmPassword:""}}},watch:{user:{handler:function(){this.errorMessage=""},deep:!0}},methods:{validUser:function(){if(this.errorMessage="",this.user.password!==this.user.confirmPassword)return this.errorMessage="Пароли не совпадают",!1;var t=x.a.validate(this.user,P);return null===t.error||(t.error.message.includes("email")?this.errorMessage="Неверный имейл":this.errorMessage="Пароль должен содержать 6+ символов",!0)},signup:function(){var t=this;if(this.validUser()){var e={email:this.user.email,password:this.user.password};this.signingUp=!0,fetch($,{method:"POST",body:k()(e),headers:{"content-type":"application/json"}}).then(function(t){return t.ok?t.json():t.json().then(function(t){throw new Error(t.message)})}).then(function(e){localStorage.token=e.token,t.signingUp=!1,t.$store.commit("setUser",e),t.$router.push("/")}).catch(function(e){t.signingUp=!1,t.errorMessage=e.message})}}}},E=j,M=(s("145a"),Object(c["a"])(E,_,C,!1,null,"3b49e466",null)),S=M.exports,O=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"mt-30 container text-center"},[a("h2",[t._v("Логин")]),t.errorMessage?a("div",{staticClass:"alert alert-warning alert-dismissible fade show",attrs:{role:"alert"}},[a("strong",[t._v(t._s(t.errorMessage))])]):t._e(),a("form",{on:{submit:function(e){return e.preventDefault(),t.login(e)}}},[a("div",{staticClass:"form-group row"},[a("label",{staticClass:"col-sm-2 col-form-label"},[t._v("Логин:")]),a("div",{staticClass:"col-sm-10"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.user.email,expression:"user.email"}],staticClass:"form-control",attrs:{placeholder:"Email/Логин",type:"text",id:"email",required:""},domProps:{value:t.user.email},on:{input:function(e){e.target.composing||t.$set(t.user,"email",e.target.value)}}})])]),a("div",{staticClass:"form-group row"},[a("label",{staticClass:"col-sm-2 col-form-label"},[t._v("Пароль:")]),a("div",{staticClass:"col-sm-10"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.user.password,expression:"user.password"}],staticClass:"form-control",attrs:{placeholder:"Пароль",type:"password",id:"password",required:""},domProps:{value:t.user.password},on:{input:function(e){e.target.composing||t.$set(t.user,"password",e.target.value)}}})])]),a("button",{staticClass:"btn btn-primary",attrs:{type:"submit"}},[t.loggingIn?a("img",{staticClass:"spinner",attrs:{src:s("5c3d")}}):a("span",[t._v("Войти")])])])])},G=[],U="http://localhost:5000/auth/login",I=x.a.object().keys({email:x.a.string().required(),password:x.a.string().required()}),q={data:function(){return{user:{email:"",password:""},errorMessage:"",loggingIn:!1}},methods:{login:function(){var t=this;if(this.errorMessage="",this.validUser()){this.loggingIn=!0;var e={email:this.user.email,password:this.user.password};fetch(U,{method:"POST",headers:{"content-type":"application/json"},body:k()(e)}).then(function(t){return t.ok?t.json():t.json().then(function(t){throw new Error(t.message)})}).then(function(e){localStorage.token=e.token,t.loggingIn=!1,t.$store.commit("setUser",e),t.$router.push("/")}).catch(function(e){t.loggingIn=!1,t.errorMessage=e.message})}},validUser:function(){var t=x.a.validate(this.user,I);return null===t.error||(t.error.message.includes("email")&&(this.errorMessage="Неверный имейл"),!1)}}},T=q,N=(s("25da"),Object(c["a"])(T,O,G,!1,null,"5e3ff9f6",null)),A=N.exports,B=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"nes-container"})},D=[],J={},z=J,F=Object(c["a"])(z,B,D,!1,null,"2d987b6e",null),H=F.exports,K=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container text-center"})},L=[],Q={},R=Object(c["a"])(Q,K,L,!1,null,null,null),V=R.exports,W=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},X=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"text-center"},[s("h2",[t._v("Not found (404)")])])}],Y={},Z=Object(c["a"])(Y,W,X,!1,null,null,null),tt=Z.exports,et=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"crash"},[s("div",{staticClass:"container"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-sm-6 crash-block"},[s("div",{staticClass:"element-container"},[t._m(0),s("div",{staticClass:"crash-element"},[s("div",{staticClass:"crash-number-container"},[s("span",{staticClass:"crash-number"},[t._v(t._s(t.counter))])])]),s("div",{staticClass:"crash-navigation"},[s("div",{staticClass:"form-row"},[s("div",{staticClass:"form-group col-md-6 m0"},[s("div",{staticClass:"form-group row m-0"},[s("label",{staticClass:"col-sm-4 col-form-label"},[t._v("Ставка: ")]),s("div",{staticClass:"col-sm-8"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.stake,expression:"stake"}],staticClass:"form-control input-stake",attrs:{type:"number",placeholder:"Ваша ставка",min:"0"},domProps:{value:t.stake},on:{input:function(e){e.target.composing||(t.stake=e.target.value)}}})])])]),s("div",{staticClass:"form-group col-md-6 m0"},[s("div",{staticClass:"buttons-right"},[t.gameInProcess||t.inGame?!t.gameInProcess&&t.inGame?s("div"):t.gameInProcess&&t.inGame?s("div",[t.inGame?s("button",{staticClass:"btn btn-danger",attrs:{type:"button"},on:{click:t.stopGame}},[t._v("Выход")]):t._e()]):s("div",[s("span",{staticClass:"font-weight-bold font-4 fs20"},[t._v("Идет игра")])]):s("div",[t.afterGame?t._e():s("button",{staticClass:"btn btn-success",attrs:{type:"button"},on:{click:t.makeStake}},[t._v("Ставка")])])])])])])])]),s("div",{staticClass:"col-sm-4 crash-block"},[s("div",{staticClass:"element-container"},[t._m(1),s("div",{staticClass:"o-y-s"},[s("ul",t._l(t.in_game,function(e){return s("li",{key:e.email,staticClass:"last-game-entity"},[s("span",[t._v(t._s(e.email)+" - "+t._s(e.rub))])])}),0)])])]),s("div",{staticClass:"col-sm-2 crash-block"},[s("div",{staticClass:"element-container"},[t._m(2),s("div",{staticClass:"o-y-s"},[s("ul",t._l(t.last_games,function(e){return s("li",{key:e._id,staticClass:"last-game-entity"},[e.last>1.99?s("span",{staticStyle:{color:"green"}},[t._v(t._s(e.last))]):s("span",{staticStyle:{color:"red"}},[t._v(t._s(e.last))])])}),0)])])])])])])},st=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"element-header text-center"},[s("p",{staticClass:"font3 font-weight-bold line-height-names"},[t._v("Crash - график")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"element-header text-center"},[s("p",{staticClass:"font3 font-weight-bold line-height-names"},[t._v("В игре:")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"element-header text-center"},[s("p",{staticClass:"font3 font-weight-bold line-height-names"},[t._v("Игры:")])])}],at=s("e814"),rt=s.n(at),nt=s("8055"),ot=s.n(nt),it={props:["user"],data:function(){return{gameInProcess:!0,counter:"Ждем...",last_games:[],in_game:[],socket:ot()("localhost:3001"),stake:0,inGame:!1,afterGame:!1}},methods:{toggleGame:function(){},makeStake:function(){if(this.gameInProcess)this.toggleAlert("Игра уже идет!");else if(0===this.stake)this.toggleAlert("Ставка должна быть больше 0");else{var t=this.stake;this.inGame=!this.inGame,this.socket.emit("stake",{id:this.socket.id,stake:rt()(t,10),email:this.$props.user.email})}},toggleAlert:function(t){alert(t)},stopGame:function(){this.socket.emit("stopGame",{id:this.socket.id,email:this.$props.user.email})}},mounted:function(){var t=this;this.socket.on("connection",function(){t.counter="Ожидаем..."}),this.socket.on("tick",function(e){e.crash&&(t.inGame=!1),e.failed&&(t.afterGame=!0),e.waiting&&(t.afterGame=!1),t.counter=e.current,t.gameInProcess=e.inProcess}),this.socket.on("succeedStake",function(){}),this.socket.on("ingamerefresh",function(e){t.in_game=e}),this.socket.on("lastgamesupdate",function(e){t.last_games=e}),this.socket.on("alert",function(e){t.toggleAlert(e),t.inGame=!1})}},lt=it,ct=(s("f1e4"),Object(c["a"])(lt,et,st,!1,null,"1bb35254",null)),ut=ct.exports;function mt(t,e,s){localStorage.token?s("/"):s()}function dt(t,e,s){localStorage.token?s():s("/login")}a["a"].use(d["a"]);var ft=new d["a"]({mode:"history",base:"/",routes:[{path:"/",name:"home",component:b},{path:"/signup",name:"signup",component:S,beforeEnter:mt},{path:"/login",name:"login",component:A,beforeEnter:mt},{path:"/dashboard",name:"dashboard",component:H,beforeEnter:dt},{path:"/crash",name:"crash",component:ut,beforeEnter:dt},{path:"/addfunds",name:"addfunds",component:V,beforeEnter:dt},{path:"*",component:tt}]}),pt=s("2f62");a["a"].use(pt["a"]);var vt=new pt["a"].Store({state:{user:{}},mutations:{setUser:function(t,e){this.state.user=e},setMoney:function(t,e){this.state.user.rub=e}},actions:{}});a["a"].config.productionTip=!1,new a["a"]({router:ft,store:vt,render:function(t){return t(m)}}).$mount("#app")},"5c3d":function(t,e,s){t.exports=s.p+"img/spinner.2d3d7f6d.svg"},"64a9":function(t,e,s){},a3fa:function(t,e,s){},f1e4:function(t,e,s){"use strict";var a=s("f978"),r=s.n(a);r.a},f978:function(t,e,s){},fa43:function(t,e,s){}});
//# sourceMappingURL=app.c55d9e72.js.map